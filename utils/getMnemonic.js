const openaiApiKey = process.env.OPENAI_API_KEY

async function getMnemonic(word) {
  if (!openaiApiKey) {
    console.error('‚ùå OPENAI_API_KEY –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.')
    return 'Mnemonic not available.'
  }

  console.log(`üîç –ó–∞–ø—Ä–æ—Å –º–Ω–µ–º–æ–Ω–∏–∫–∏ –¥–ª—è —Å–ª–æ–≤–∞: "${word}"`)

  try {
    const response = await fetch('https://api.openai.com/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${openaiApiKey}`,
      },
      body: JSON.stringify({
        model: 'gpt-4',
        messages: [
          {
            role: 'system',
            content: `
            –¢—ã ‚Äî –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—é –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö —Å–ª–æ–≤ —Å –ø–æ–º–æ—â—å—é –∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω–æ–π –º–Ω–µ–º–æ—Ç–µ—Ö–Ω–∏–∫–∏. –¢–≤–æ—è —Ü–µ–ª—å ‚Äî —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ª–µ–≥–∫–æ –∏ –Ω–∞–¥–æ–ª–≥–æ –∑–∞–ø–æ–º–Ω–∏–ª –∫–∞–∂–¥–æ–µ —Å–ª–æ–≤–æ. –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–ª–æ–≤–æ, –¥–µ–ª–∞–π —Å–ª–µ–¥—É—é—â–µ–µ:
            
            1. –£–∫–∞–∂–∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–µ —Å–ª–æ–≤–æ, –µ–≥–æ –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫—É—é —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é (–≤ —Å–∫–æ–±–∫–∞—Ö) –∏ –¥–æ–±–∞–≤—å –ø—Ä–∏–º–µ—Ä —á—Ç–µ–Ω–∏—è —Ä—É—Å—Å–∫–∏–º–∏ –±—É–∫–≤–∞–º–∏ (–≤ —Å–∫–æ–±–∫–∞—Ö, –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ).
            3. –ü—Ä–∏–≤–µ–¥–∏ –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫.
            4. –ü—Ä–∏–¥—É–º–∞–π —è—Ä–∫—É—é, –Ω–µ–æ–±—ã—á–Ω—É—é, –∑–∞–ø–æ–º–∏–Ω–∞—é—â—É—é—Å—è –∞—Å—Å–æ—Ü–∏–∞—Ü–∏—é (–º–Ω–µ–º–æ–Ω–∏–∫—É). –û–Ω–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –∞–±—Å—É—Ä–¥–Ω–æ–π, —Å–º–µ—à–Ω–æ–π, –≤–∏–∑—É–∞–ª—å–Ω–æ–π, —Ä–∏—Ñ–º–æ–≤–∞–Ω–Ω–æ–π –∏–ª–∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π. –û—Å–Ω–æ–≤—ã–≤–∞–π –∞—Å—Å–æ—Ü–∏–∞—Ü–∏—é –Ω–∞ –∑–≤—É—á–∞–Ω–∏–∏ –∏/–∏–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–∏ —Å–ª–æ–≤–∞.
               - –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∏—Ç–º–∏—á–Ω—É—é —Ñ—Ä–∞–∑—É –∏–ª–∏ —Ä–∏—Ñ–º—É, –µ—Å–ª–∏ —ç—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç.
               - –ú–æ–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å —Å–ª–æ–≤–æ –≤ –≤–∏–¥–µ —Å—Ü–µ–Ω—ã, –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –∏–ª–∏ –æ–±—Ä–∞–∑–∞, –∫–∞–∫ –≤ –º–µ—Ç–æ–¥–µ –ê–π–≤–∞–∑–æ–≤—Å–∫–æ–≥–æ –∏–ª–∏ –¶–∏—Ü–µ—Ä–æ–Ω–∞.
            5. –°–æ—Å—Ç–∞–≤—å –≤–∑—Ä—ã–≤–Ω–æ–π, –∑–∞–ø–æ–º–∏–Ω–∞—é—â–∏–π—Å—è,–æ—á–µ–Ω—å —á—É–¥–Ω—ã–π –æ–±—Ä–∞–∑ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ö–æ–∂–∏—Ö –ø–æ –∑–≤—É—á–∞–Ω–∏—é —Å–ª–æ–≤ –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥–ª–∏ –±—ã —Å–æ—Å—Ç–∞–≤–∏—Ç—å –¥–∞–Ω–Ω–æ–µ —Å–ª–æ–≤–æ –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.
            6. –£–∫–∞–∂–∏ 2‚Äì3 –∑–Ω–∞—á–µ–Ω–∏—è —Å–ª–æ–≤–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏–≤–µ–¥–∏:
               - –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º (–∫—É—Ä—Å–∏–≤–æ–º),
               - –ü–µ—Ä–µ–≤–æ–¥ –ø—Ä–∏–º–µ—Ä–∞ –Ω–∞ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫ (–≤ —Å–∫–æ–±–∫–∞—Ö). 
            7. –ü—Ä–∏–≤–µ–¥–∏ 3 –ø—Ä–∏–º–µ—Ä–∞ –≤–æ–ø—Ä–æ—Å–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π —Å —ç—Ç–∏–º —Å–ª–æ–≤–æ–º:  –û–¥–Ω–æ –≤ –ø—Ä–æ—à–µ–¥—à–µ–º –≤—Ä–µ–º–µ–Ω–∏,–û–¥–Ω–æ –≤ –Ω–∞—Å—Ç–æ—è—â–µ–º –≤—Ä–µ–º–µ–Ω–∏, –û–¥–Ω–æ –≤ –±—É–¥—É—â–µ–º –≤—Ä–µ–º–µ–Ω–∏
            8.–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–∑–¥–∞–π –º–∏–Ω–∏-–≤–∏–∫—Ç–æ—Ä–∏–Ω—É –ø–æ —ç—Ç–æ–º—É —Å–ª–æ–≤—É, —á—Ç–æ–±—ã —è –º–æ–≥ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∏ –ø–æ—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è. –°—Ñ–æ–∫—É—Å–∏—Ä—É–π—Å—è –Ω–∞ —Ç–æ–º, —á—Ç–æ–±—ã –ø–æ–º–æ—á—å –º–Ω–µ –ø–æ–Ω—è—Ç—å, –∫–∞–∫ —Å–ª–æ–≤–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö. –ù–µ –∑–∞–±—É–¥—å –¥–∞—Ç—å –º–Ω–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã. –í–∫–ª—é—á–∏: –û–¥–∏–Ω –≤–æ–ø—Ä–æ—Å —Å –≤—ã–±–æ—Ä–æ–º –æ—Ç–≤–µ—Ç–∞, –û–¥–∏–Ω –≤–æ–ø—Ä–æ—Å —Å –ø—Ä–æ–ø—É—Å–∫–æ–º, –û–¥–∏–Ω –≤–æ–ø—Ä–æ—Å ¬´–ø—Ä–∞–≤–¥–∞ –∏–ª–∏ –ª–æ–∂—å¬ª
            
            –§–æ—Ä–º–∞—Ç–∏—Ä—É–π –æ—Ç–≤–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ: –¥–µ–ª–∞–π –∑–∞–≥–æ–ª–æ–≤–∫–∏, —Å–ø–∏—Å–∫–∏ –∏ –∞–±–∑–∞—Ü—ã –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —á—Ç–µ–Ω–∏—è.
            
            –ë—É–¥—å –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º, –ª—ë–≥–∫–∏–º –∏ –ø–æ–Ω—è—Ç–Ω—ã–º. –ù–∏–∫–∞–∫–æ–π —Å—É—Ö–æ–π –∞–∫–∞–¥–µ–º–∏—á–Ω–æ—Å—Ç–∏. –ü–æ–º–æ–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–µ –ø—Ä–æ—Å—Ç–æ —É–∑–Ω–∞—Ç—å, –∞ –∑–∞–ø–æ–º–Ω–∏—Ç—å —Å–ª–æ–≤–æ ‚Äî –Ω–∞–≤—Å–µ–≥–¥–∞.
            `,
          },
          {
            role: 'user',
            content: word,
          },
        ],
      }),
    })

    if (!response.ok) {
      const errorText = await response.text()
      console.error(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç OpenAI API (${response.status}): ${errorText}`)
      return 'Mnemonic not available.'
    }

    const data = await response.json()
    const result = data?.choices?.[0]?.message?.content

    if (!result) {
      console.warn('‚ö†Ô∏è –ü–æ–ª—É—á–µ–Ω –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –æ—Ç OpenAI.')
      return 'Mnemonic not available.'
    }

    console.log('‚úÖ –ú–Ω–µ–º–æ–Ω–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ.')
    return result
  } catch (err) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ OpenAI API:', err)
    return 'Mnemonic not available.'
  }
}

module.exports = getMnemonic
